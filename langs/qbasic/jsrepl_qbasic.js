(function(){self.JSREPLEngine=function(){function b(e,a,c,b,h,i){this.sandbox=h;this.virtual_machine=new this.sandbox.QBasic.VirtualMachine({print:a,input:e,result:c,error:b});i()}b.name="JSREPLEngine";b.prototype.Eval=function(e){var a=this;try{return this.virtual_machine.run(e,function(){return a.virtual_machine.stack.length?a.virtual_machine.cons.result(a.virtual_machine.stack.pop().toString()):a.virtual_machine.cons.result("")})}catch(c){return this.virtual_machine.cons.error(c.message)}};b.prototype.EvalSync=
function(e){var a,c=this;a=null;this.virtual_machine.run(e,function(){if(c.virtual_machine.stack.length)return a=c.virtual_machine.stack.pop()});return a};b.prototype.GetNextLineIndent=function(e){var a,c,b,h,i;this.sandbox.QBasic.Program.prototype.createParser();h=this.sandbox.QBasic.Program.parser;if(h.parse(e+"\n")===true)return false;i=h.tokenizer;b=function(){var a,b,g,d;g=e.split("\n");d=[];for(a=0,b=g.length;a<b;a++)c=g[a],d.push(c+"\n");return d}();a=function(a,b){var g,d,f,c,e,j;b==null&&
(b=false);d=[];for(e=0,j=a.length;e<j;e++)if(g=a[e],!h.parse(g))switch(i.setText(g),f=i.nextToken(0,0),g=f.text,f=i.nextToken(0,f.locus.position+f.text.length),f=f.text,c=d[d.length-1],g){case "SUB":case "FUNCTION":case "FOR":case "IF":case "SELECT":case "WHILE":d.push(g);break;case "DO":d.push(f==="WHILE"?"DOWHILE":"DO");break;case "ELSE":if(b&&d.length===0)d.push("IF");else if(c!=="IF")return-1;break;case "WEND":if(c==="WHILE")d.pop();else return-1;break;case "FOR":if(c==="NEXT")d.pop();else return-1;
break;case "LOOP":if(f==="WHILE"||f==="UNTIL")if(c==="DO")d.pop();else return-1;else if(c==="DOWHILE")d.pop();else return-1;break;case "END":if(c===f)d.pop();else return-1}return d.length};return a(b)<=0?false:a([b.slice(-1)[0]],true)>0?1:0};return b}()}).call(this);
